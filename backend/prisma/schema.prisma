generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  AGENT
}

enum Status {
  ACTIVE
  INACTIVE
}

enum LeadStatus {
  INITIAL_CONTACT
  COLD
  WARM
  WAITING_FOR_LOCATION
  WON
  NEGOTIATIONS
  LOST
  FOLLOW_UP
  DATE_SHIPMENT
  CANCELLED
}

model User {
  id         String         @id @default(uuid())
  name       String
  email      String         @unique
  password   String
  role       Role
  status     Status         @default(ACTIVE)
  leads      Lead[]
  activities LeadActivity[]
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  @@index([role])
}

model Lead {
  id            String         @id @default(uuid())
  customerName  String
  phone         String
  phone2        String?
  source        String?
  country       String?
  product       String?
  qty           Int?
  notes         String?
  city          String?
  address       String?
  value         Float?
  paymentMethod String?
  shipmentDate  DateTime?
  assignedTo    String
  status        LeadStatus     @default(INITIAL_CONTACT)
  lastActivityAt DateTime?
  user          User           @relation(fields: [assignedTo], references: [id])
  activities    LeadActivity[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([assignedTo])
  @@index([status])
}

model LeadActivity {
  id        String      @id @default(uuid())
  leadId    String
  agentId   String
  status    LeadStatus
  remarks   String?
  value     Float?
  followUp  DateTime?
  lead      Lead        @relation(fields: [leadId], references: [id])
  agent     User        @relation(fields: [agentId], references: [id])
  createdAt DateTime    @default(now())

  @@index([leadId])
  @@index([agentId])
}
