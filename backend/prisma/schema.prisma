generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  AGENT
}

enum Status {
  ACTIVE
  INACTIVE
}

enum LeadStatus {
  NEW
  CONTACTED
  INTERESTED
  FOLLOW_UP
  CONVERTED
  NOT_INTERESTED
}

enum OrderStatus {
  NEW
  CONFIRMED
  CANCELLED
  SHIPPED
  DELIVERED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
}

model User {
  id         String         @id @default(uuid())
  name       String
  email      String         @unique
  password   String
  role       Role
  status     Status         @default(ACTIVE)
  leads      Lead[]
  activities LeadActivity[]
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  @@index([role])
}

model Lead {
  id             String         @id @default(uuid())
  customerName   String
  phone          String
  source         String?
  externalId     String?        @unique
  airtableLeadId String?        @unique
  leadDate       DateTime?
  country        String?
  customerPath   String?
  customerId     String?
  assignedStaff  Staff?         @relation(fields: [assignedStaffId], references: [id])
  assignedStaffId String?
  leadSource     String?
  adSource       String?
  language       String?
  city           String?
  address        String?
  product1       String?
  qty1           Int?
  product2       String?
  qty2           Int?
  value          Float?
  reason         String?
  notes          String?
  dispatchFlag   Boolean?
  paymentMethod  String?
  csRemarks      String?
  metadata       Json?
  assignedTo     String
  status         LeadStatus     @default(NEW)
  lastActivityAt DateTime?
  user           User           @relation(fields: [assignedTo], references: [id])
  activities     LeadActivity[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([assignedTo])
  @@index([status])
}

model Staff {
  id        String   @id @default(uuid())
  staffId   String   @unique
  name      String
  role      String?
  country   String?
  leads     Lead[]
  orders    Order[]  @relation("SalesStaff")
  deliveries Order[] @relation("DeliveryStaff")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String        @id @default(uuid())
  productCode String        @unique
  name        String
  orderItems  OrderItem[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Customer {
  id         String   @id @default(uuid())
  customerId String   @unique
  phoneKey   String?
  phone1     String?
  phone2     String?
  name       String?
  country    String?
  city       String?
  address    String?
  leads      Lead[]
  orders     Order[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Order {
  id                 String       @id @default(uuid())
  orderKey           String       @unique
  emNumber           String?
  orderDate          DateTime?
  country            String?
  customerId         String?
  customer           Customer?    @relation(fields: [customerId], references: [id])
  salesStaffId       String?
  salesStaff         Staff?        @relation("SalesStaff", fields: [salesStaffId], references: [id])
  sourceLeadId       String?
  sourceLead         Lead?         @relation(fields: [sourceLeadId], references: [id])
  product1           String?
  qty1               Int?
  product2           String?
  qty2               Int?
  value              Float?
  orderStatus        OrderStatus   @default(NEW)
  paymentMethod      String?
  dispatchFlag       Boolean?
  csRemarks          String?
  deliveryStaffId    String?
  deliveryStaff      Staff?        @relation("DeliveryStaff", fields: [deliveryStaffId], references: [id])
  trackingNumber     String?
  cancellationReason String?
  notes              String?
  orderItems         OrderItem[]
  payments           Payment[]
  complaints         Complaint[]
  feedbacks          CustomerFeedback[]
  followups          DeliveryFollowup[]
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
}

model OrderItem {
  id         String   @id @default(uuid())
  orderItemId String  @unique
  orderId    String
  order      Order    @relation(fields: [orderId], references: [id])
  productId  String?
  product    Product? @relation(fields: [productId], references: [id])
  quantity   Int?
  lineValue  Float?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Payment {
  id           String         @id @default(uuid())
  paymentId    String         @unique
  orderId      String
  order        Order          @relation(fields: [orderId], references: [id])
  emNumber     String?
  country      String?
  amount       Float?
  status       PaymentStatus  @default(PENDING)
  method       String?
  paymentDate  DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model Complaint {
  id            String   @id @default(uuid())
  complaintId   String   @unique
  orderId       String?
  order         Order?   @relation(fields: [orderId], references: [id])
  emNumber      String?
  orderDate     DateTime?
  customerName  String?
  phone1        String?
  phone2        String?
  complaint     String?
  department    String?
  notes1        String?
  notes2        String?
  cs            String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model CustomerFeedback {
  id                String   @id @default(uuid())
  feedbackId        String   @unique
  orderId           String?
  order             Order?   @relation(fields: [orderId], references: [id])
  emNumber          String?
  country           String?
  orderDate         DateTime?
  salesStaffId      String?
  salesStaff        Staff?   @relation(fields: [salesStaffId], references: [id])
  customerName      String?
  phone1            String?
  phone2            String?
  feedback          String?
  notes             String?
  googleReviewLink  String?
  recommendedPerfume String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model DeliveryFollowup {
  id                String   @id @default(uuid())
  followupId        String   @unique
  orderId           String?
  order             Order?   @relation(fields: [orderId], references: [id])
  emNumber          String?
  date              DateTime?
  deliveryStaffId   String?
  deliveryStaff     Staff?   @relation(fields: [deliveryStaffId], references: [id])
  salesStaffId      String?
  salesStaff        Staff?   @relation(fields: [salesStaffId], references: [id])
  customerName      String?
  customerPhone1    String?
  customerPhone2    String?
  salesInstructions String?
  salesRemarks      String?
  csUpdate          String?
  csRemarks         String?
  deliveredCancelledDate DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model EmSeriesSetting {
  id          String   @id @default(uuid())
  seriesId    String   @unique
  country     String?
  prefix      String?
  nextCounter Int?
  active      Boolean?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Vendor {
  id          String          @id @default(uuid())
  name        String
  contactName String?
  email       String?
  phone       String?
  status      Status          @default(ACTIVE)
  products    VendorProduct[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([status])
}

model VendorProduct {
  id          String   @id @default(uuid())
  vendorId    String
  name        String
  sku         String?
  price       Float?
  description String?
  status      Status   @default(ACTIVE)
  vendor      Vendor   @relation(fields: [vendorId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([vendorId])
  @@index([status])
}

model LeadActivity {
  id        String      @id @default(uuid())
  leadId    String
  agentId   String
  status    LeadStatus
  remarks   String?
  value     Float?
  followUp  DateTime?
  lead      Lead        @relation(fields: [leadId], references: [id])
  agent     User        @relation(fields: [agentId], references: [id])
  createdAt DateTime    @default(now())

  @@index([leadId])
  @@index([agentId])
}
